
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>瀑布流布局</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #main {
            position: relative;
        }

        .box {
            padding: 15px 0 0 15px;
            float: left;
        }

        .pic {
            box-sizing: border-box;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 5px #ccc;
        }

        .pic img {
            /** 设置每行显示数量在这处理 **/
            width: 400px;/**  1903/437=4.354691075514874 向下取整一行为4个 **/
            height: auto;
        }
    </style>
    <script>
        window.onload = function () {
            waterfall('main', 'box');
        };

        function waterfall(parent, box) {
            var Parent = document.getElementById(parent);
            var Box = getByClass(Parent, box);

            var Boxw = Box[0].offsetWidth;
            var clips = Math.floor(document.documentElement.clientWidth / Boxw);
            Parent.style.cssText = 'width:' + Boxw * clips + 'px;margin:0 auto;';
            console.log(document.documentElement.clientWidth / Boxw,document.documentElement.clientWidth , Boxw)
            var heightArr = [];
            for (var i = 0; i < Box.length; i++) {
                if (i < clips) {
                    heightArr.push(Box[i].offsetHeight)
                }
                else {
                    var minH = Math.min.apply(null, heightArr);
                    var index = getMinHIndex(heightArr, minH);
                    Box[i].style.position = 'absolute';
                    Box[i].style.top = minH + 'px';
                    Box[i].style.left = Boxw * index + 'px';
                    heightArr[index] += Box[i].offsetHeight;
                }
            }
        }
        function getByClass(parent, clsName) {
            var boxArr = new Array(),
                allElements = parent.getElementsByTagName('*');
            for (var i = 0; i < allElements.length; i++) {
                if (allElements[i].className == clsName) {
                    boxArr.push(allElements[i]);
                }
            }
            return boxArr;
        }
        function getMinHIndex(arr, val) {
            for (var i in arr) {
                if (arr[i] == val) {
                    return i
                }
            }
        }
    </script>
</head>

<body>
    <div id="main">
        <div class="box">
            <div class="pic">
                <img src="./images/00.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/01.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/02.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/03.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/04.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/05.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/06.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/07.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/08.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/09.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/10.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/11.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/12.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/13.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/14.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/15.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/16.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/17.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/18.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/19.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/20.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/21.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/22.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/23.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/24.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/25.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/26.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/27.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/28.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/29.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="./images/30.jpg" alt="">
            </div>
        </div>
</body>

</html>